// Amsify42 FileUpload 1.0.0
// http://www.amsify42.com
!function(e,a,i){function s(e){var a='<div class="'+f.substring(1)+'">';return a+='<span title="Select Images" class="'+p.substring(1)+'">Select Files</span>',a+='<img class="amsify-fileupload-loader" src="'+AmsifyHelper.base_url+'/images/loader-small.gif"/>',a+='<span title="Clear Images" class="'+m.substring(1)+'">Clear</span>',a+="</div>",a+='<div class="'+c.substring(1)+'"></div>',r(),a}function r(e){a(document).on("click",m,function(){a(e).val(""),a(c).hide(),a(u).hide(),a(m).hide(),a(y).show()})}function o(e){return e.substr(e.lastIndexOf(".")+1).toLowerCase()}function l(e){e!==i&&(e.hasOwnProperty("type")&&(n=e.type),e.hasOwnProperty("field")&&(t=e.field))}var t=".amsify-fileupload-field",n="",f=".amsify-fileupload-button-area",d=".amsify-fileupload-info-area",p=".amsify-fileupload-select",c=".amsify-fileupload-info",u=".amsify-fileupload-upload",m=".amsify-fileupload-remove",y=".amsify-fileupload-drag-area",g=".amsify-fileupload-info";a.fn.amsifyFileUpload=function(a){if(a!==i)a.field=this;else var a={field:this};var s=new e.FileUpload;s.set(a)},e.init=function(a){l(a);var i=new e.FileUpload;i.set()},e.set=function(a){var i=new e.FileUpload;i.set(a)},e.FileUpload=function(r){e.FileUpload.prototype.set=function(r){var o=n,l=t,f=g,c="",u="",m={};r!==i&&(r.hasOwnProperty("type")&&(o=r.type),r.hasOwnProperty("field")&&(l=r.field),r.hasOwnProperty("form")&&(form=r.form),r.hasOwnProperty("infoArea")&&(f=r.infoArea),r.hasOwnProperty("callback")&&(u=r.callback),r.hasOwnProperty("ajaxMethod")&&(c=r.ajaxMethod),r.hasOwnProperty("extraParams")&&(m=r.extraParams)),a(l).each(function(i,o){a(document).on("click",p,function(){a(o).click()}),a(o).hide(),a(o).after('<div class="'+y.substring(1)+'" ondragover="return false">Or drag and drop files here</div>'),a(o).after('<div class="'+d.substring(1)+'">'+s(o)+"</div>"),a(o).change(function(){e.readFileSource(o,this.files,r)}),a(document).on({dragover:function(e){e.stopPropagation(),e.preventDefault(),a(this).css("opacity","0.7"),a(this).addClass("amsify-drag-border")},dragleave:function(e){e.stopPropagation(),e.preventDefault(),a(this).css("opacity","1"),a(this).removeClass("amsify-drag-border")},drop:function(i){i.stopPropagation(),i.preventDefault(),files=i.originalEvent.target.files||i.originalEvent.dataTransfer.files,e.readFileSource(o,files,r),a(this).css("opacity","1"),a(this).removeClass("amsify-drag-border"),a(o).val("")}},y)})}},e.readFileSource=function(s,r,l){if(r){var t=5,n=5,f="all";if(l!==i&&(l.hasOwnProperty("fileLimit")&&(t=l.fileLimit),l.hasOwnProperty("maxSize")&&(n=l.maxSize),l.hasOwnProperty("extensions")&&(f=l.extensions)),r.length>t)return AmsifyHelper.showFlash("Maximum "+t+" images are allowed","error"),!1;a(".amsify-fileupload-loader").show(),a(c).show(),a(u).show(),a(m).show();var d="<ol>";a.each(r,function(i,s){var t=s.name,p=o(t);t=AmsifyHelper.shortFileName(t);var c="0%",u=(s.size/1048576).toFixed(2),m=!0;if(u>n&&(m=!1,c="max size exceeded"),"all"!=f&&-1===a.inArray(p,f)&&(m=!1,c="file not allowed"),m){var y=new FileReader;y.onload=function(a){e.callAjax(a.target.result,i,l)},y.readAsDataURL(r[i]),d+="<li>"+t+' <img id="amsifyupload-loader-'+i+'" class="amsify-fileupload-loader-each" src="'+AmsifyHelper.base_url+'/images/loader-small.gif"/><span class="amsifyupload-percentage" id="amsifyupload-percentage-'+i+'">'+c+"</span></li>"}else d+="<li>"+t+' <img id="amsifyupload-loader-'+i+'" class="amsify-fileupload-loader-each" src="'+AmsifyHelper.base_url+'/images/loader-small.gif" style="display:none;"/><span class="amsifyupload-percentage" id="amsifyupload-percentage-'+i+'"  style="background:red;">'+c+"</span></li>"}),d+="</ol>",a(c).html(d),a(y).hide(),a(".amsify-fileupload-loader").hide()}},e.callAjax=function(e,s,r){var o=AmsifyHelper.base_url,l={index:s,image:e,_token:AmsifyHelper.getToken()};r!==i&&(r.hasOwnProperty("ajaxMethod")&&(o=r.ajaxMethod),r.hasOwnProperty("extraParams")&&(l=a.extend({},l,extraParams)));var t={};t.xhr=function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var i=parseInt(e.loaded/e.total*100);a("#amsifyupload-percentage-"+s).text(i+"%")}},!1),e},t.beforeSend=function(){a("#amsifyupload-percentage-"+s).addClass("amsifyupload-processing")},t.afterSuccess=function(e){a("#amsifyupload-percentage-"+s).css("background","green"),r.afterUpload&&"function"==typeof r.afterUpload&&r.afterUpload(e),a("#amsifyupload-percentage-"+s).removeClass("amsifyupload-processing"),a(".amsifyupload-processing").length||r.afterComplete&&"function"==typeof r.afterComplete&&r.afterComplete(e)},t.afterError=function(e){a("#amsifyupload-percentage-"+s).css("background","red").text("not uploaded"),a("#amsifyupload-percentage-"+s).removeClass("amsifyupload-processing"),a(".amsifyupload-processing").length||r.afterComplete&&"function"==typeof r.afterComplete&&r.afterComplete(e)},t.afterResponseError=function(e){a("#amsifyupload-percentage-"+s).css("background","red").text("not uploaded")},t.complete=function(){a("#amsifyupload-loader-"+s).hide()},AmsifyHelper.callAjax(o,l,t)}}(window.AmsifyFileUpload=window.AmsifyFileUpload||{},jQuery);